{{/* Hugo Blox: Markdown */}}
{{/* Documentation: https://hugoblox.com/blocks/ */}}
{{/* License: https://github.com/HugoBlox/hugo-blox-builder/blob/main/LICENSE.md */}}

{{/* I override this partial to support the glucose widget */}}

{{/* Initialise */}}
{{ $page := .wcPage }}
{{ $block := .wcBlock }}
{{ $columns := $block.design.columns | default "1" }}

{{/* Enhanced Glucose Widget CSS */}}
<style>
.donut {
    margin: 20px;
    position: relative;
    transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
  }

  circle {
    fill: none;
  }

  .circle-border {
    stroke: #e5e5e5;
    stroke-width: 1px;
  }

  .circle-back {
    stroke: #f2f2f2;
    stroke-width: 30px;
  }

  .circle-front {
    stroke: url(#quotaDonut__gradient);
    stroke-width: 30px;
    stroke-dasharray: 629px;
    stroke-dashoffset: 629px;
    transition: stroke-dashoffset 1.2s cubic-bezier(0.4, 0, 0.2, 1), 
                stroke 0.6s ease;
  }

  /* Glucose level states */
  .donut.critical-low .circle-front {
    stroke: #d32f2f !important;
    stroke: url(#criticalLowGradient);
    stroke-dashoffset: 600px;
  }

  .donut.one-quarter-filled .circle-front {
    stroke: #ff9800 !important;
    stroke: url(#lowGradient);
    stroke-dashoffset: 471px;
  }

  .donut.half-filled .circle-front {
    stroke: #4caf50 !important;
    stroke: url(#normalGradient);
    stroke-dashoffset: 314px;
  }

  .donut.three-quarter-filled .circle-front {
    stroke: #ff9800 !important;
    stroke: url(#highGradient);
    stroke-dashoffset: 157px;
  }

  .donut.critical-high .circle-front {
    stroke: #d32f2f !important;
    stroke: url(#criticalHighGradient);
    stroke-dashoffset: 100px;
  }

  .donut.almost-empty .circle-front {
    stroke: #cccccc;
    stroke-dashoffset: 600px;
  }

  /* Text styling */
  .glucose-reading {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 8px;
  }

  .glucose-value {
    font-size: 2.2rem;
    font-weight: 700;
    color: var(--primary-color, #1565c0);
  }

  .glucose-trend-arrow {
    font-size: 1.8rem;
    font-weight: 600;
    color: var(--secondary-color, #666);
  }

  .glucose-status {
    font-size: 1.1rem;
    line-height: 1.4;
    color: var(--text-color, #333);
    margin-bottom: 6px;
  }

  .glucose-timestamp {
    font-size: 0.9rem;
    color: var(--muted-color, #888);
    font-style: italic;
  }

  .glucose-loading {
    color: var(--muted-color, #888);
    font-style: italic;
  }

  .glucose-error .glucose-value {
    color: var(--error-color, #dc3545);
  }

  .glucose-error ~ .glucose-status {
    color: var(--error-color, #dc3545);
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .donut {
      margin: 10px auto;
      max-width: 200px;
    }
    
    .glucose-value {
      font-size: 1.8rem;
    }
    
    .glucose-trend-arrow {
      font-size: 1.4rem;
    }
  }

  /* Dark mode support */
  @media (prefers-color-scheme: dark) {
    .circle-border {
      stroke: #444;
    }
    
    .circle-back {
      stroke: #333;
    }
    
    .glucose-value {
      color: var(--primary-color-dark, #64b5f6);
    }
    
    .glucose-status {
      color: var(--text-color-dark, #e0e0e0);
    }
    
    .glucose-timestamp {
      color: var(--muted-color-dark, #aaa);
    }
  }

  /* Loading animation */
  .glucose-loading {
    animation: glucose-pulse 1.5s ease-in-out infinite;
  }

  @keyframes glucose-pulse {
    0%, 100% {
      opacity: 1;
    }
    50% {
      opacity: 0.5;
    }
  }
</style>

{{/* Enhanced SVG gradients */}}
<svg style="display: none;">
  <defs>
    <linearGradient id="quotaDonut__gradient">
      <stop stop-color="#4caf50" offset="0%"></stop>
      <stop stop-color="#8bc34a" offset="100%"></stop>
    </linearGradient>
    
    <linearGradient id="criticalLowGradient">
      <stop stop-color="#d32f2f" offset="0%"></stop>
      <stop stop-color="#f44336" offset="100%"></stop>
    </linearGradient>
    
    <linearGradient id="lowGradient">
      <stop stop-color="#ff9800" offset="0%"></stop>
      <stop stop-color="#ffb74d" offset="100%"></stop>
    </linearGradient>
    
    <linearGradient id="normalGradient">
      <stop stop-color="#4caf50" offset="0%"></stop>
      <stop stop-color="#66bb6a" offset="100%"></stop>
    </linearGradient>
    
    <linearGradient id="highGradient">
      <stop stop-color="#ff9800" offset="0%"></stop>
      <stop stop-color="#ff7043" offset="100%"></stop>
    </linearGradient>
    
    <linearGradient id="criticalHighGradient">
      <stop stop-color="#d32f2f" offset="0%"></stop>
      <stop stop-color="#e53935" offset="100%"></stop>
    </linearGradient>
  </defs>
</svg>

{{/* Custom HTML */}}
<!--<section id="glucose" class="home-section wg-collection">-->
<!-- <div class="home-section-bg "></div>-->
<!--  <div class="container">-->
<!--    <div class="row">-->
<!--        <div class="section-heading col-12 col-lg-4 mb-3 mb-lg-0 d-flex flex-column align-items-center align-items-lg-start">-->
<!--          <h1 class="mb-0">Glucose Stats</h1>-->
<!--        </div>-->
<!--    <div class="col-12 col-lg-8">-->
<!--      <p>test</p>-->
<!--    </div>-->
<!--  </div>-->
<!--</section>-->
<div class="row">
  <div class="section-heading col-12 col-lg-4 mb-3 mb-lg-0 d-flex flex-column align-items-center align-items-lg-start">
    <h1 class="mb-0">Blood Glucose Stats</h1>
  </div>
  <div class="col-12 col-lg-8">
    <div class="donut">
      <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="100%" height="100%" viewBox="0 0 230 230" enable-background="new 0 0 340 333" xml:space="preserve">

        <defs>
          <linearGradient id="quotaDonut__gradient">
          <stop stop-color="#fc0023" offset="0%"></stop>
          <stop stop-color="#f50" class="quotaDonut__gradientStopEnd" offset="100%"></stop>
          </linearGradient>
        </defs>

        <g transform="translate(115, 115)">
        <circle r="100" class="circle-back" />
        <circle r="115" class="circle-border" />
        <circle r="85"  class="circle-border" />
        <circle r="100" class="circle-front" transform="rotate(135.1)" />
        </g>
        <g id="svg_1">
          <path d="m117.5772,63.18713c-0.92796,-1.31666 -2.43543,-2.10089 -4.03533,-2.10089c-1.60345,0 -3.10736,0.78064 -4.04243,2.10089c-9.98341,14.09833 -34.99531,51.18062 -34.99531,68.64616c0,21.81479 17.47455,39.49977 39.03418,39.49977c21.56319,0 39.04128,-17.68497 39.04128,-39.49977c0.00356,-17.46554 -25.019,-54.54783 -35.00241,-68.64616l0.00002,0l-0.00002,0l0.00002,0zm-17.74477,91.00416c-1.06659,1.28429 -2.60251,1.94983 -4.14908,1.94983c-1.2266,0 -2.47098,-0.42451 -3.4878,-1.2879c-15.39111,-13.11623 -10.07942,-32.48837 -9.84476,-33.31219c0.83194,-2.91031 3.81488,-4.57951 6.70538,-3.7485c2.87273,0.83102 4.52951,3.86726 3.71534,6.76678c-0.1671,0.62953 -3.49136,13.46517 6.41384,21.90472c2.28253,1.94981 2.57763,5.40695 0.64706,7.72728l0.00001,0zm10.65538,10.89661c-3.17492,0 -5.75966,-2.6153 -5.75966,-5.82782c0,-3.22331 2.58475,-5.83144 5.75966,-5.83144c3.18561,0 5.75967,2.61172 5.75967,5.83144c0,3.2197 -2.57761,5.82782 -5.75967,5.82782z" fill="#fc0023"/>
        </g>
      </svg>
    </div>

    <div class="h3" id="glucose-text"></div>

    <div class="h5">
      <p>A person without Type 1 Diabetes has an average blood glucose reading of 120. The graphic shows whether I am above, below, or at average. Leveraging an open source project called Nightscout I am able to scrape the data from the continous glucose monitor that I wear on my body.</p>
    </div>
  </div>
</div>



